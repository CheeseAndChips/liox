#!/bin/bash

set -e

for P in $(ls /usr/share/liox-config/patches/*.patch); do
    patch -d/ -p0 < ${P}
done

cp -aT /usr/share/liox-config/post-inst-overlay /

cat >> /etc/hosts <<EOF
34.243.103.175 olimp.cms.lmio.lt
94.176.234.76 ctrl.lmio.lt
EOF

useradd -m -s /bin/bash -p $(cat /usr/share/liox-config/d0-shadow) d0
useradd -m -s /bin/bash -p $(cat /usr/share/liox-config/d1-shadow) d1
useradd -m -s /bin/bash -p $(cat /usr/share/liox-config/d2-shadow) d2
shred --remove /usr/share/liox-config/d*-shadow

systemctl disable apt-daily-upgrade.timer
systemctl disable apt-daily.timer
update-grub
